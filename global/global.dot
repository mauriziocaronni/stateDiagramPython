digraph finite_state_machine {
    rankdir=TD;
	rank =same
    size="8,5"
    fontsize = "24"
    label="Schema globale stati"
    node [shape=box,style=rounded ];
 
subgraph start {
        node [shape = "box" style = "filled" ];
        label = "start";
        InizializzazioneIncarico
        CreazioneManualeIncarico
        RiaperturaAutomatica
}

subgraph end {
        node [shape = "box" style = "filled" ];
        label = "end";
		rank = sink
        ChiusuraManuale
        ChiusuraAutomatica
}


subgraph cluster_apertura {
    node [shape=box,style=rounded ];
        label = "APERTURA";
		CreazioneAutomaticaIncarico
		CompletamentoManualeIncarico
		VenditaRiparazione
		EsecuzioneTriage
		SceltaManualeServizio
		VenditaRiparazionePA1
		SceltaAutomaticaServizio
		InvioLinkSelfCare
}

subgraph cluster_accertamenti {
    node [shape=box,style=rounded ];
    label = "ACCERTAMENTI";
	
    subgraph cluster_visio {
        node [shape=box,style=rounded ];
        label = "VISIO";
        AvvioVisio
		AvvioManualeVisio
		EsecuzioneVisio
		RiassegnazioneVisio
    }

    subgraph cluster_desk {
    node [shape=box,style=rounded ];
    label = "DESK";
		AvvioDesk
		AvvioManualeDesk
		EsecuzioneDesk
		RiassegnazioneDesk
    }

    subgraph cluster_sopralluogo {
        node [shape=box,style=rounded ];
        label = "SOPRALLUOGO";
	    AvvioSopralluogo
	    AssegnazioneSopralluogo
	    PianificazioneSopralluogo
	    EsecuzioneSopralluogo
        VerificaSopralluogoDopoRifiuto
        ApprovazioneSopralluogo
    }

    subgraph cluster_sopralluogoPce {
        node [shape=box,style=rounded ];
        label = "SOPRALLUOGOPCE";
		AvvioSopralluogoPCE
		AssegnazioneSopralluogoPCE
        PianificazioneSopralluogoPCE
        EsecuzioneSopralluogoPCE
        VerificaSopralluogoPCEDopoRifiuto
        ApprovazioneSopralluogoPCE
    }

    subgraph cluster_selfcare {
        node [shape=box,style=rounded ];
        label = "SELFCARE";
        AvvioAccertSelfCare
    }
}

subgraph cluster_perizia {
    node [shape=box,style=rounded ];
    label = "PERIZIA";        

	subgraph cluster_peritoReferente {
		node [shape=box,style=rounded ];
		label = "perito referente";             
		AvvioPerizia
		AvvioPeriziaPostDesk 
		AvvioPeriziaContestazione
		AvvioPeriziaIncompleta
		AvvioPeriziaIntegrazione
		EsecuzionePerizia  
		PeriziaInRevisione
		ComunicazioneEsito
		InvioEmailEsito       
		InvioAtto             
		AttesaRicezioneAtto   
	
	}

	subgraph cluster_collaborazione {
		node [shape=box,style=rounded ];
		label = "perito ingaggiato";
		CollaborazionePerizia    
		CollaborazioneRifiutata  
		CollaborazioneCancellata 
		CollaborazioneCompletata 
	
	
	}


	subgraph cluster_revisione {
		node [shape=box,style=rounded ];
		RevisionePerizia    
		RevisioneRifiutata  
		RevisioneCompletata   label = "perito revisore";
	
	}
	
	
	subgraph cluster_conciliation {
		node [shape=box,style=rounded ];
		label = "perito conciliatore";
		AvvioPeriziaConciliazione
		ConciliazionePerizia
		
	}
	
	subgraph cluster_authority {
		node [shape=box,style=rounded ];
		label = "perito supervisore";
		VerificaAuthority
	}


}


subgraph cluster_riparazione {
    node [shape=box,style=rounded ];
    label = "RIPARAZIONE";

    subgraph cluster_gestore {
        node [shape=box,style=rounded ];
        label = "GESTORE";
        AvvioRiparazione
        ConfigurazioneRiparazione
        DefinizioneTimeline 
        AssegnazioneMonitoraggio
        VerificaChiusuraRiparazione
    }

    subgraph cluster_perito {
            node [shape=box,style=rounded ];
            label = "PERITO";
            MonitoraggioAttivita
            ApprovazioneBudget
            ApprovazioneAttivita
    }

    subgraph cluster_cat {
        node [shape=box,style=rounded ] ;
        label = "CAT";
        PianificazioneAppuntamentoR
        EsecuzioneSopralluogoR
        BudgetInApprovazione
        EsecuzioneAttivita 
        AttivitaInApprovazione
        AttivitaApprovata
    }
    
}

subgraph cluster_chiusura {
    node [shape=box,style=rounded ];
    label = "CHIUSURA e RIAPERTURA";
    AvvioChiusura
    VerificaChiusura
    SelezioneTipoRiapertura
    GestioneContestazione
    FinalizzaContestazione
}


comment = "apertura"

    InizializzazioneIncarico     -> CreazioneAutomaticaIncarico  [label = "Inizializzazione"];
    CreazioneAutomaticaIncarico  -> CompletamentoManualeIncarico [label = "DatiNonCompleti"];
    CreazioneAutomaticaIncarico  -> VenditaRiparazione           [label = "VenditaRiparazione"];
    CreazioneAutomaticaIncarico  -> EsecuzioneTriage             [label = "RiparazioneNonPrevista"];
    RiaperturaAutomatica         -> SelezioneTipoRiapertura      [ label = "RiaperturaAutomatica" ]
    VenditaRiparazione           -> AvvioRiparazione             [label = "RiparazioneVenduta"];
    VenditaRiparazione           -> SceltaManualeServizio        [label = "RiparazioneNonVenduta"];
    VenditaRiparazione           -> VenditaRiparazione           [label = "CampiObbligMancanti"];
    VenditaRiparazionePA1        -> SceltaAutomaticaServizio     [label = "NonInteressatoRiparazione"] ;
    VenditaRiparazionePA1        -> VenditaRiparazione           [label = "InteressatoRiparazione"] ;
    VenditaRiparazionePA1        -> SceltaAutomaticaServizio     [label = "TimerScaduto"] ;
    CompletamentoManualeIncarico -> CompletamentoManualeIncarico [label = "DatiNonCompleti"];
    CompletamentoManualeIncarico -> VenditaRiparazione           [label = "VenditaRiparazione"];
    CompletamentoManualeIncarico -> EsecuzioneTriage             [label = "RiparazioneNonPrevista"];
    CreazioneManualeIncarico     -> CompletamentoManualeIncarico [label = "Inizializzazione"];
    InvioLinkSelfCare            -> SceltaAutomaticaServizio     [label = "SelfCareEseguito"];
    InvioLinkSelfCare            -> SceltaAutomaticaServizio     [label = "SelfCareNonEseguito"];
    InvioLinkSelfCare            -> SceltaAutomaticaServizio     [label = "TimerScaduto"];
    EsecuzioneTriage             -> InvioLinkSelfCare            [label = "InvioLinkSelfCare"];
    EsecuzioneTriage             -> AvvioSopralluogoPCE          [label = "SopralluogoPCE"];
    EsecuzioneTriage             -> VenditaRiparazionePA1        [label = "VenditaRiparazionePA1"];
    EsecuzioneTriage             -> AvvioVisio                   [label = "Visio"];
    EsecuzioneTriage             -> AvvioDesk                    [label = "Desk"];   
    EsecuzioneTriage             -> AvvioSopralluogo             [label = "Sopralluogo"]; 
    EsecuzioneTriage             -> SceltaManualeServizio        [label = "NessunServizio"]  
    EsecuzioneTriage             -> SceltaManualeServizio        [label = "CampiObbligMancanti"] 
    SceltaAutomaticaServizio     -> AvvioSopralluogoPCE          [label = "SopralluogoPCE"];
    SceltaAutomaticaServizio     -> AvvioVisio                   [label = "Visio"];
    SceltaAutomaticaServizio     -> AvvioDesk                    [label = "Desk"];   
    SceltaAutomaticaServizio     -> AvvioSopralluogo             [label = "Sopralluogo"];   
    SceltaAutomaticaServizio     -> AvvioAccertSelfCare          [label = "SelfCare"];   
    SceltaAutomaticaServizio     -> SceltaManualeServizio        [label = "NessunServizio"];   
    SceltaAutomaticaServizio     -> SceltaManualeServizio        [label = "CampiObbligMancanti"];
    SceltaManualeServizio        -> AvvioSopralluogoPCE          [label = "SopralluogoPCE"];
    SceltaManualeServizio        -> AvvioManualeVisio            [label = "Visio"];
    SceltaManualeServizio        -> AvvioManualeDesk             [label = "Desk"];   
    SceltaManualeServizio        -> AvvioSopralluogo             [label = "Sopralluogo"];   
    SceltaManualeServizio        -> InvioLinkSelfCare            [label = "InvioLinkSelfCare"];
    SceltaManualeServizio        -> VenditaRiparazione           [label = "VenditaRiparazione"];
    SceltaManualeServizio        -> SceltaManualeServizio        [label = "CampiObbligMancanti"];

comment = "ACCERTAMENTI"

    AvvioVisio	                 ->	EsecuzioneVisio	    		[ label = "VisioPianificata"];
    EsecuzioneVisio	             ->	RiassegnazioneVisio			[ label = "VisioRifiutata"];
    EsecuzioneVisio	             ->	EsecuzioneVisio	    		[ label = "AppuntamentoModificato"];
    EsecuzioneVisio	             ->	EsecuzioneVisio  			[ label = "AppuntamentoAnnullato"];
    EsecuzioneVisio	             ->	AvvioManualeVisio			[ label = "VisioCompletataNuovaVisio"];
    EsecuzioneVisio	             ->	AvvioPerizia	    		[ label = "VisioCompletata"];
    EsecuzioneVisio	             ->	EsecuzioneVisio  			[ label = "DatiObbligatoriMancanti"];
    AvvioManualeVisio	         ->	EsecuzioneVisio	    		[ label = "VisioPianificata"];
    RiassegnazioneVisio	         ->	AvvioManualeVisio			[ label = "VisioAssegnata"];
 
    AvvioDesk	              ->	EsecuzioneDesk	            [ label = "DeskPianificata"];
    EsecuzioneDesk	          ->	RiassegnazioneDesk	        [ label = "DeskRifiutata"];
    EsecuzioneDesk	          ->	EsecuzioneDesk	            [ label = "AppuntamentoModificato"];
    EsecuzioneDesk	          ->	EsecuzioneDesk  	        [ label = "AppuntamentoAnnullato"];
    EsecuzioneDesk	          ->	AvvioManualeDesk	        [ label = "DeskCompletataNuovaDesk"];
    EsecuzioneDesk	          ->	AvvioPeriziaPostDesk	    [ label = "DeskCompletata"];
    EsecuzioneDesk	          ->	EsecuzioneDesk  	        [ label = "DatiObbligatoriMancanti"];
    AvvioManualeDesk	      ->	EsecuzioneDesk	            [ label = "DeskPianificata"];
    RiassegnazioneDesk	      ->	AvvioManualeDesk	        [ label = "DeskAssegnata"];
 
    AvvioSopralluogo               -> AssegnazioneSopralluogo        [ label = "SopralluogoAvviato"];
    AssegnazioneSopralluogo        -> PianificazioneSopralluogo      [ label = "SopralluogoAssegnato"];
    PianificazioneSopralluogo      -> EsecuzioneSopralluogo          [ label = "SopralluogoPianificato"];
    PianificazioneSopralluogo      -> VerificaSopralluogoDopoRifiuto [ label = "SopralluogoRifiutato"];
    VerificaSopralluogoDopoRifiuto -> PianificazioneSopralluogo      [ label = "SopralluogoAssegnato"];
    EsecuzioneSopralluogo          -> EsecuzioneSopralluogo          [ label = "AppuntamentoModificato"];
    EsecuzioneSopralluogo          -> PianificazioneSopralluogo      [ label = "AppuntamentoAnnullato"];
    EsecuzioneSopralluogo          -> ApprovazioneSopralluogo        [ label = "SopralluogoCompletatoNuovo"];
    ApprovazioneSopralluogo        -> AvvioSopralluogo               [ label = "Approvato"];
    EsecuzioneSopralluogo          -> PianificazioneSopralluogo      [ label = "ChiusuraAttivita"];
    EsecuzioneSopralluogo	       -> EsecuzioneSopralluogo  	     [ label = "DatiObbligatoriMancanti"];
 
    
    AvvioSopralluogoPCE               -> AssegnazioneSopralluogoPCE        [ label = "SopralluogoPCEAvviato"];
    AssegnazioneSopralluogoPCE        -> PianificazioneSopralluogoPCE      [ label = "SopralluogoPCEAssegnato"];
    PianificazioneSopralluogoPCE      -> EsecuzioneSopralluogoPCE          [ label = "SopralluogoPCEPianificato"];
    PianificazioneSopralluogoPCE      -> VerificaSopralluogoPCEDopoRifiuto [ label = "SopralluogoPCERifiutato"];
    VerificaSopralluogoPCEDopoRifiuto -> PianificazioneSopralluogoPCE      [ label = "SopralluogoPCEAssegnato"];
    EsecuzioneSopralluogoPCE          -> EsecuzioneSopralluogoPCE          [ label = "AppuntamentoModificato"];
    EsecuzioneSopralluogoPCE          -> PianificazioneSopralluogoPCE      [ label = "AppuntamentoAnnullato"];
    EsecuzioneSopralluogoPCE          -> ApprovazioneSopralluogoPCE        [ label = "SopralluogoPCECompletatoNuovo"];
    ApprovazioneSopralluogoPCE        -> AvvioSopralluogoPCE               [ label = "Approvato"];
    EsecuzioneSopralluogoPCE          -> PianificazioneSopralluogoPCE      [ label = "ChiusuraAttivita"];       
    EsecuzioneSopralluogoPCE	       -> EsecuzioneSopralluogoPCE  	     [ label = "DatiObbligatoriMancanti"];   

    AvvioAccertSelfCare                -> AvvioPerizia	      [ label = "SelfCareInPerizia"];
    AvvioAccertSelfCare                -> AvvioChiusura       [ label = "SelfCareInChiusura"];
    EsecuzioneSopralluogo              -> AvvioPerizia        [ label = "SoprallugoCompletato"];
    ApprovazioneSopralluogo            -> AvvioPerizia        [ label = "NonApprovato"];
    EsecuzioneSopralluogoPCE           -> AvvioPerizia        [ label = "SoprallugoCompletato"];
    ApprovazioneSopralluogoPCE         -> AvvioPerizia        [ label = "NonApprovato"];

comment = "PERIZIA"
   
    AvvioPerizia               -> EsecuzionePerizia           [ label = "PeriziaAvviata"]   ;
    EsecuzionePerizia          -> EsecuzionePerizia           [ label = "CollabAvviata" ]    ;
     
    EsecuzionePerizia          -> PeriziaInRevisione          [ label = "RevisioneAvviata" ]    ;

    EsecuzionePerizia          -> CollaborazionePerizia       [ label = "CollabAvviata" style ="dotted"]    ;
    CollaborazionePerizia      -> CollaborazioneRifiutata     [ label = "CollabRifiutata"  ] ;
    CollaborazionePerizia      -> CollaborazioneCancellata    [ label = "CollabCancellata" ] ;
    CollaborazionePerizia      -> CollaborazioneCompletata    [ label = "CollabCompletata" ] ;
 
    CollaborazioneRifiutata     -> EsecuzionePerizia  [ style = "dotted"]  
    CollaborazioneCancellata    -> EsecuzionePerizia  [ style = "dotted"]
    CollaborazioneCompletata    -> EsecuzionePerizia  [ style = "dotted"]

    EsecuzionePerizia          -> RevisionePerizia            [ label = "RevisioneAvviata" style ="dotted"]    ;
    RevisionePerizia           -> RevisioneRifiutata          [ label = "RevisioneRifiutata"  ] ;
    RevisionePerizia           -> RevisioneCompletata         [ label = "RevisioneCompletata" ] ;
 
    RevisioneRifiutata         -> PeriziaInRevisione  [ style = "dotted" ] ;
    RevisioneCompletata        -> PeriziaInRevisione  [ style = "dotted" ] ;

    PeriziaInRevisione         -> EsecuzionePerizia    [label = "RevisioniCompletate"]
    PeriziaInRevisione         -> PeriziaInRevisione   [label = "RevisioniNonCompletate"]
    

    EsecuzionePerizia          -> EsecuzionePerizia           [ label = "CollaborazioneNonCompletata"]  ;
    EsecuzionePerizia          -> VerificaAuthority           [ label = "AuthorityNecessaria"]  ;
    EsecuzionePerizia          -> ComunicazioneEsito          [ label = "AuthorityNonNecessaria"]  ;

    VerificaAuthority          -> ComunicazioneEsito          [ label = "PeriziaApprovata"];
    VerificaAuthority          -> EsecuzionePerizia           [ label = "PeriziaNonApprovata"] ;

    ComunicazioneEsito          -> ConciliazionePerizia        [ label = "AccordoNonRaggiunto"] ;
    ComunicazioneEsito          -> AvvioChiusura               [ label = "AccordoRaggiunto-o-NonRichiesto"] ;
    ComunicazioneEsito          -> InvioEmailEsito             [ label = "EsitoScrittoEmail"] ;
    ComunicazioneEsito          -> InvioAtto                   [ label = "EsitoScrittoAtto"] ;
    InvioEmailEsito             -> AttesaRicezioneAtto         [ label = "EmailEsitoInviata"] ;
    InvioAtto                   -> AttesaRicezioneAtto         [ label = "AttoInviato"] ;
    AttesaRicezioneAtto          -> ConciliazionePerizia       [ label = "ConciliazioneAvviata"] ;
    AttesaRicezioneAtto          -> AvvioChiusura              [ label = "ForzaturaChiusura"] ;

    ConciliazionePerizia       -> AvvioChiusura                   [ label = "ChiusuraConAccordo"] ;
    ConciliazionePerizia       -> ConciliazionePerizia           [ label = "DatiObbligatoriMancanti"] ;
    ConciliazionePerizia       -> AvvioPeriziaConciliazione      [ label = "PeriziaConcilazione"]   ;
    AvvioPeriziaConciliazione  -> EsecuzionePerizia              [ label = "PeriziaConcilazioneAvviata"]   ;
    

    ComunicazioneEsito          -> ComunicazioneEsito              [ label = "DatiObbligatoriMancanti"] ;

    AvvioPeriziaPostDesk        -> EsecuzionePerizia   [ label = "PeriziaAvviata"]   ;
    VerificaChiusura            -> EsecuzionePerizia   [ label = "PeriziaIncompletaAvviata"]   ;
 
 comment = "RIPARAZIONE"

    AvvioRiparazione           -> ConfigurazioneRiparazione    [ label = "RiparazioneAvviata" ]  ;
    ConfigurazioneRiparazione  -> DefinizioneTimeline          [ label = "RiparazioneConfigurata" ]  ;
    DefinizioneTimeline        -> AssegnazioneMonitoraggio     [ label = "TimelineDefinita" ]  ;
    AssegnazioneMonitoraggio   -> VerificaChiusuraRiparazione  [ label = "MonitoraggioTerminato" ]  ;

    DefinizioneTimeline        -> PianificazioneAppuntamentoR  [ style = "dotted" ];
    AssegnazioneMonitoraggio   -> MonitoraggioAttivita         [ style = "dotted" ];

     
    PianificazioneAppuntamentoR -> EsecuzioneSopralluogoR       [ label = "AppuntamentoPianificato" ];
    EsecuzioneSopralluogoR      -> ApprovazioneBudget           [ style = "dotted" ];
    EsecuzioneSopralluogoR      -> BudgetInApprovazione         [ label = "SoprallugoCompletato"]
    BudgetInApprovazione        -> EsecuzioneAttivita           [ label = "BudgetApprovato" ] 
    EsecuzioneAttivita          -> AttivitaInApprovazione       [ label = "AttivitaCompletata" ]
    AttivitaInApprovazione      -> AttivitaApprovata            [ label = "AttivitaApprovata" ]
    AttivitaApprovata           -> PianificazioneAppuntamentoR  [ label = "NuovoSopralluogo" ];
    AttivitaApprovata           -> MonitoraggioAttivita         [ style = "dotted" ]  ;

    ApprovazioneBudget          -> BudgetInApprovazione        [ style = "dotted" ]  ;
    ApprovazioneAttivita        -> AttivitaApprovata           [ style = "dotted" ]  ;
    EsecuzioneAttivita          -> AttivitaApprovata           [ style = "dotted" ]  ;

    MonitoraggioAttivita        ->  VerificaChiusuraRiparazione [ style = "dotted" ]  ;

    VerificaChiusuraRiparazione  -> ConfigurazioneRiparazione    [ label = "RiparazioneNonChiusa" ] ;
    VerificaChiusuraRiparazione  -> AvviaPeriziaPostRiparazione  [ label = "PeriziaPostRiparazione" ];
    AvviaPeriziaPostRiparazione  -> EsecuzionePerizia            [ label = "PeriziaPostRiparazioneAvviata" ];
    VerificaChiusuraRiparazione  -> AvvioChiusuraPostRiparazione [ label = "ChiusuraPostRiparazione" ];
    AvvioChiusuraPostRiparazione -> VerificaChiusura             [ lable = "ChiusuraAvviata"]

comment = "CHIUSURA"

    AvvioChiusura              -> VerificaChiusura        [ label = "ChiusuraAvviata"]
    VerificaChiusura           -> ChiusuraManuale         [ label = "ChiusuraVerificata"]
    VerificaChiusura           -> ChiusuraAutomatica      [ label = "ChiusuraVerificata"]
    VerificaChiusura           -> VerificaChiusura        [ label = "DatiObbligatoriMancanti"]
    VerificaChiusura           -> AvvioPeriziaIncompleta  [ label = "PeriziaIncompleta"]
    AvvioPeriziaIncompleta     -> EsecuzionePerizia       [ label = "PeriziaIncompletaAvviata"]
   
    CreazioneManualeIncarico   ->  SelezioneTipoRiapertura    [ label = "RiaperturaManaule" ]
    SelezioneTipoRiapertura    ->  AvvioPeriziaIntegrazione   [ label = "PeriziaIntegrazione" ]
    AvvioPeriziaIntegrazione   ->  EsecuzionePerizia          [ label = "PeriziaIntegrazioneAvviata"]

    SelezioneTipoRiapertura    ->  SceltaManualeServizio [ label = "NonRiapertura"]
    SelezioneTipoRiapertura    ->  GestioneContestazione [ label = "GestioneContestazione"]

    GestioneContestazione       -> AvvioPeriziaContestazione [ label = "PeriziaContestazione" ]
    AvvioPeriziaContestazione   -> EsecuzionePerizia         [ label = "PeriziaContestazioneAvviata"]

    GestioneContestazione       -> FinalizzaContestazione [ label = "ContestazioneFinalizzata"]
    FinalizzaContestazione      -> AvvioChiusura          [ label = "ChiusuraAvviata"]
}
